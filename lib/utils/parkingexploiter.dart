import 'package:penguin_parking/models/parking_space.dart';
import 'package:penguin_parking/utils/parkingspaceexploiter.dart';
import '../models/parking.dart';

class ParkingRepository {
  static final ParkingRepository _instance = ParkingRepository._internal();
  List<Parking> currentParkings = [];

  factory ParkingRepository() {
    return _instance;
  }

  ParkingRepository._internal();

  bool addAndStartParking(Parking newParking) {
    try {
      currentParkings.add(newParking);
      return true;
    } catch (e) {
      print('Error adding and starting parking: $e');
      return false;
    }
  }

  double removeParkingOccupantAndFinishParking(plateNumber) {
    DateTime now = DateTime.now();
    Parking? parking =
        currentParkings.singleWhere((x) => x.broom == plateNumber);
    ParkingSpace? parkingSpace = ParkingSpaceRepository()
        .getAllParkingSpaces()
        .singleWhere((x) => x.id == parking.parkingSpace);
    double price =
        parkingSpace.hourPrice * now.difference(parking.startTime).inHours;
    currentParkings.removeWhere((x) => x.broom == plateNumber);
    print('Parking with plate number $plateNumber removed!');
    return price;
  }

  List<Parking> getAllActiveParkings() {
    return currentParkings;
  }
}

final parkingRepository = ParkingRepository();
